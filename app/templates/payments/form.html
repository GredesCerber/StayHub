{% extends "base/layout.html" %}

{% block title %}{{ 'Edit Payment' if payment else 'New Payment' }} - StayHub{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4><i class="bi bi-credit-card"></i> {{ 'Edit Payment' if payment else 'Record New Payment' }}</h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ '/payments/' ~ payment.id ~ '/edit' if payment else '/payments/new' }}">
                    <div class="mb-3">
                        <label for="booking_id" class="form-label">Booking *</label>
                        <select class="form-select" id="booking_id" name="booking_id" required>
                            <option value="">Select Booking</option>
                            {% for booking in bookings %}
                            <option value="{{ booking.id }}" {{ 'selected' if payment and payment.booking_id == booking.id }}>
                                #{{ booking.id }} - {{ booking.guest.first_name }} {{ booking.guest.last_name }} 
                                (Room {{ booking.room.room_number }}, ${{ "%.2f"|format(booking.total_cost or 0) }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="amount" class="form-label">Amount ($) *</label>
                        <input type="number" class="form-control" id="amount" name="amount" 
                               value="{{ payment.amount if payment else '' }}" step="0.01" min="0" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="payment_method" class="form-label">Payment Method *</label>
                        <select class="form-select" id="payment_method" name="payment_method" required>
                            <option value="cash" {{ 'selected' if payment and payment.payment_method == 'cash' }}>Cash</option>
                            <option value="card" {{ 'selected' if payment and payment.payment_method == 'card' }}>Card</option>
                            <option value="transfer" {{ 'selected' if payment and payment.payment_method == 'transfer' }}>Bank Transfer</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="status" class="form-label">Status *</label>
                        <select class="form-select" id="status" name="status" required>
                            <option value="pending" {{ 'selected' if payment and payment.status == 'pending' }}>Pending</option>
                            <option value="completed" {{ 'selected' if (not payment) or (payment and payment.status == 'completed') }}>Completed</option>
                            <option value="refunded" {{ 'selected' if payment and payment.status == 'refunded' }}>Refunded</option>
                        </select>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="/payments" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-check-circle"></i> {{ 'Update' if payment else 'Record' }} Payment
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
