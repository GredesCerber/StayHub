# StayHub

StayHub — учебная информационная система для управления мини-отелем. Проект демонстрирует полный цикл работы с гостями, номерами, бронированиями, услугами и платежами. Интерфейс и демонстрационные данные локализованы на русский язык и адаптированы под презентацию.

## Основные возможности
- **Номера и типы номеров**: справочник типов с рекомендованными параметрами, быстрые операции над номерами, фильтрация по доступности.
- **Гости**: карточка гостя с контактами и документами, поиск по ФИО и e-mail.
- **Бронирования**: проверка доступности на выбранные даты, расчёт стоимости, статусы «в ожидании», «подтверждено», «отменено», «завершено».
- **Услуги и допродажи**: настройка платных услуг с ценой и активностью, добавление услуг к брони с учётом количества.
- **Платежи**: учёт поступлений и возвратов по разным каналам (наличные, карта, перевод).
- **Отчёты**: панель показателей (доход, загрузка, статус броней, популярность услуг).

## Логика бронирований и статусов номеров
- **Жёсткий контроль пересечений**: один и тот же номер нельзя забронировать на совпадающие даты или с наложением диапазонов. Любая попытка выдаёт подробное сообщение с перечислением конфликтующих броней.
- **Интервал подготовки**: между выездом и новым заездом того же номера требуется санитарная пауза в 2 ночи. Если до следующей брони меньше двух суток, система блокирует создание и помечает номер как находящийся в подготовке.
- **Статусы номеров**:
   - `available` — номер свободен и не имеет активных броней; можно заселять сразу.
   - `reserved` — есть подтверждённая будущая бронь, но до заезда ≥2 суток, поэтому номер доступен для альтернативных дат.
   - `turnover` — текущее окно подготовки: либо гость только выехал и идёт уборка, либо ближайший гость заезжает менее чем через 2 суток. Новые брони недоступны.
   - `occupied` — гость уже живёт; номер исключён из выдачи.
- **Динамическая синхронизация**: при каждом создании, изменении статуса или отмене брони пересчитывается состояние номера (`status`, `is_available`). Отчёты и формы бронирования сразу получают актуальную картину.
- **Сценарии проверки**: например, бронирование №1 (28–29 ноября) блокирует любые заезды вплоть до 1 декабря. Заявка на 30 ноября попадёт в конфликт, а заявка с 1 декабря будет разрешена и переведёт номер в режим `reserved`.

## Технологический стек
- **FastAPI** — основа REST API и серверных шаблонов.
- **SQLAlchemy + SQLite** — ORM слой и встроенная БД для демонстрации.
- **Jinja2 + Bootstrap 5** — шаблоны пользовательского интерфейса.
- **Pydantic** — валидация входных данных и схемы.

## Архитектура
```
├── app/
│   ├── main.py                # Точка входа FastAPI
│   ├── database.py            # Инициализация сессий и Base
│   ├── core/                  # Зависимости, валидаторы, исключения
│   ├── models/                # SQLAlchemy-модели домена
│   ├── schemas/               # Pydantic-схемы ответа и запросов
│   ├── repositories/          # Классические CRUD-репозитории
│   ├── services/              # Бизнес-логика и агрегации
│   ├── routes/                # REST и HTML-маршруты
│   ├── templates/             # Шаблоны Jinja2
│   └── static/                # CSS и другие статические ресурсы
├── seed_data.py               # Скрипт демонстрационного наполнения
├── requirements.txt           # Зависимости Python
├── stayhub_launcher.bat       # Внутренний лаунчер (вызывается из корня)
└── README.md                  # Этот файл
```

## Подготовка к показу
1. **Очистите БД (опционально)**: удалите файл `stayhub.db`, чтобы начать с чистой базы.
2. **Заполните демонстрационными данными**:
   ```bash
   python seed_data.py
   ```
   Скрипт создаёт справочник типов номеров и наполняет систему русскоязычными данными (номера, гости, услуги, бронирования и платежи).
3. **Запустите сервер**:
   ```bash
   uvicorn app.main:app --reload
   ```
4. **Откройте интерфейс**: http://localhost:8000 — веб-панель администратора отеля. Разделы меню соответствуют основным сущностям системы.
5. **Документация API**: http://localhost:8000/docs — Swagger UI со всеми REST-эндпоинтами.

> Для демонстрации без командной строки используйте `StayHubLauncher.bat` из корневой папки: он предлагает пункты «Заполнить базу» и «Запустить сервер».

## Установка и запуск для разработки
```bash
git clone https://github.com/GredesCerber/StayHub.git
cd StayHub/stayhub_package

python -m venv venv
./venv/Scripts/Activate.ps1   # PowerShell
pip install -r requirements.txt

python seed_data.py           # при необходимости
uvicorn app.main:app --reload
```

### Полезные команды
- `pytest` — базовая проверка (при добавлении тестов).
- `alembic upgrade head` — возможная интеграция миграций (в демо не используется).

## REST API (кратко)
- `GET/POST/PUT/DELETE /rooms/api` — управление номерами.
- `GET/POST/PUT/DELETE /room-types/api` — справочник типов номеров.
- `GET/POST/PUT/DELETE /guests/api` — каталог гостей.
- `GET/POST/PUT/DELETE /services/api` — дополнительные услуги.
- `GET/POST/PUT/DELETE /bookings/api` — заявки на проживание.
- `GET/POST/PUT/DELETE /payments/api` — платежи.
- `GET /bookings/api/availability` — проверка доступности номера по датам.
- `GET /reports/api/summary` — сводная статистика.

Полный перечень и примеры запросов доступны в Swagger UI (`/docs`).

## Страницы интерфейса
- **Главная** — ключевые показатели, быстрый переход к отчётам.
- **Номера / Типы номеров** — таблицы и формы редактирования с русскими наименованиями.
- **Гости** — журнал гостей, отдельная форма создания.
- **Бронирования** — статусные карточки, обслуживание, расчёт стоимости.
- **Услуги и платежи** — управление прайс-листом и поступлениями.
- **Отчёты** — визуализация загрузки, доходов и популярности услуг.

## Сценарий быстрой демонстрации
1. На главной странице подчеркните показатели «Загрузка», «Выручка», «Активные брони».
2. В разделе «Номера» покажите локализованный справочник типов и наличие свободных комнат.
3. Создайте новую бронь: добавьте русскоязычного гостя, проверьте даты, подключите услуги.
4. Завершите демонстрацию отчётами «Доходы» и «Загрузка».

## Работа с данными
- Повторный запуск `seed_data.py` пропускает вставку, если таблицы уже заполнены. Для перезалива удалите `stayhub.db`.
- Названия типов номеров и сами номера синхронизированы; это важно для фильтров и отчётов.

## Обратная связь
Проект создан для учебных целей. Предложения по улучшению приветствуются.
